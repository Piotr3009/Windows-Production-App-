<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sash Production Planner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/custom.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <div class="header-content">
        <div class="header-left">
          <div class="app-logo">
            <div class="logo-icon">SW</div>
            <span>Sash Planner Pro</span>
          </div>
          <span class="badge badge-info" id="active-project-label">Brak projektu</span>
        </div>
        <div class="header-right">
          <button data-action="new-project" class="btn btn-ghost">Nowy</button>
          <button data-action="save-project" class="btn btn-primary">Zapisz</button>
          <div class="h-6 w-px bg-slate-200 mx-2"></div>
          <button data-action="export-pdf" class="btn btn-secondary export-pdf-btn">Export PDF</button>
          <button data-action="export-excel" id="export-excel-btn" class="btn btn-outline">Export Excel</button>
        </div>
      </div>
    </header>

    <div class="app-body">
      <aside class="app-sidebar">
        <nav class="sidebar-nav">
          <div class="nav-group">
            <div class="nav-group-title">Edytor</div>
            <div class="nav-item is-active" data-view-trigger="designer">
              <span>Konfigurator</span>
            </div>
            <div class="nav-item" data-view-trigger="precut">
              <span>Pre-Cut List</span>
              <span class="nav-item-badge">PC</span>
            </div>
            <div class="nav-item" data-view-trigger="cutlists">
              <span>Cut Lists</span>
              <span class="nav-item-badge">CL</span>
            </div>
          </div>

          <div class="nav-group">
            <div class="nav-group-title">Produkcja</div>
            <div class="nav-item" data-view-trigger="optimizer">
              <span>Optymalizacja</span>
            </div>
            <div class="nav-item" data-view-trigger="reports">
              <span>Raporty</span>
            </div>
          </div>
          
          <div class="nav-group">
            <div class="nav-group-title">Projekt</div>
            <div class="card p-3 bg-slate-50 border border-slate-200">
               <label class="form-label text-xs">Nazwa projektu</label>
               <input id="project-name" type="text" class="form-input mb-2 text-xs" placeholder="Nazwa..." />
               <label class="form-label text-xs">Klient</label>
               <input id="project-client" type="text" class="form-input text-xs" placeholder="Klient..." />
            </div>
          </div>
        </nav>
        
        <div class="sidebar-footer">
           <div class="flex items-center justify-between">
              <span class="text-xs font-semibold text-slate-500">Status</span>
              <span id="project-status" class="badge badge-warning">W toku</span>
           </div>
        </div>
      </aside>

      <main class="app-main">
        <div class="main-content">
          
          <div id="view-designer" class="view-panel block">
            <div class="grid grid-cols-1 lg:grid-cols-[380px,1fr] gap-6">
              
              <div class="flex flex-col gap-6">
                 <div class="card">
                    <div class="card-header">
                       <h3 class="card-title">Parametry Okna</h3>
                    </div>
                    <div class="card-body space-y-4">
                       <div class="form-group">
                          <label class="form-label">Nazwa okna</label>
                          <input id="window-name" type="text" class="form-input" placeholder="Np. Okno Kuchnia" />
                       </div>
                       <div class="grid grid-cols-2 gap-4">
                          <div class="form-group">
                             <label class="form-label">Szerokość (mm)</label>
                             <input id="frame-width" type="number" class="form-input" value="1200" />
                          </div>
                          <div class="form-group">
                             <label class="form-label">Wysokość (mm)</label>
                             <input id="frame-height" type="number" class="form-input" value="1500" />
                          </div>
                       </div>
                       
                       <div class="p-3 bg-slate-50 rounded-lg border border-slate-100">
                          <div class="flex items-center justify-between mb-2">
                             <label class="flex items-center gap-2 text-sm font-semibold">
                                <input id="horns" type="checkbox" class="rounded text-primary focus:ring-primary" />
                                Rogi (Horns)
                             </label>
                          </div>
                          <input id="horn-extension-mm" type="number" class="form-input text-sm" placeholder="Długość (np. 75)" value="75" />
                       </div>

                       <div class="form-group">
                          <label class="form-label">Układ szprosów</label>
                          <select id="grid-mode" class="form-select">
                             <option value="2x2">2x2 Tradycyjny</option>
                             <option value="3x3">3x3 Georgian</option>
                             <option value="6x6">6x6 Fine</option>
                             <option value="custom">Niestandardowy</option>
                          </select>
                       </div>
                       
                       <div id="grid-custom" class="hidden p-3 bg-slate-50 rounded-lg border border-dashed border-slate-300">
                          <div class="grid grid-cols-2 gap-2 mb-3">
                             <div>
                                <label class="text-xs text-slate-500">Wiersze</label>
                                <input id="rows" type="number" class="form-input text-xs" value="2">
                             </div>
                             <div>
                                <label class="text-xs text-slate-500">Kolumny</label>
                                <input id="cols" type="number" class="form-input text-xs" value="2">
                             </div>
                          </div>
                          <div class="flex gap-2">
                             <button id="add-vertical-bar" class="btn btn-sm btn-outline w-full">+ Pion</button>
                             <button id="add-horizontal-bar" class="btn btn-sm btn-outline w-full">+ Poziom</button>
                          </div>
                          <ul id="custom-bars-list" class="mt-2 space-y-1"></ul>
                       </div>

                    </div>
                    <div class="card-footer">
                       <button id="btn-new-window" class="btn btn-ghost btn-sm">Reset</button>
                       <button id="btn-save-window" class="btn btn-success flex-1">Dodaj do projektu</button>
                    </div>
                 </div>

                 <div class="card">
                    <div class="card-header">
                       <h3 class="card-title text-base">Szklenie i Wykończenie</h3>
                    </div>
                    <div class="card-body space-y-4">
                       <div class="grid grid-cols-2 gap-4">
                          <div class="form-group">
                             <label class="form-label">Grubość szkła</label>
                             <input id="glass-thickness" type="number" class="form-input" value="24" />
                          </div>
                          <div class="form-group">
                             <label class="form-label">Kolor ramki</label>
                             <input id="spacer-colour" type="text" class="form-input" value="White" />
                          </div>
                       </div>
                       <div class="flex gap-4">
                          <label class="flex items-center gap-2 text-sm">
                             <input id="glass-toughened" type="checkbox" /> Hartowane
                          </label>
                          <label class="flex items-center gap-2 text-sm">
                             <input id="glass-frosted" type="checkbox" /> Mrożone
                          </label>
                       </div>
                       <div class="form-group">
                          <label class="form-label">Kolor RAL</label>
                          <input id="color-ral" type="text" class="form-input" placeholder="np. 9010" />
                       </div>
                       
                       <div class="mt-4 pt-4 border-t border-slate-100">
                          <label class="form-label mb-2">Dostępne sekcje (Raw)</label>
                          <div class="space-y-2">
                             <label class="flex items-center justify-between text-sm">
                                <span>63x63 mm</span>
                                <input type="checkbox" id="raw-63x63" checked />
                             </label>
                             <label class="flex items-center justify-between text-sm">
                                <span>63x95 mm</span>
                                <input type="checkbox" id="raw-63x95" checked />
                             </label>
                             <label class="flex items-center justify-between text-sm">
                                <span>63x120 mm</span>
                                <input type="checkbox" id="raw-63x120" />
                             </label>
                          </div>
                       </div>
                    </div>
                 </div>
              </div>

              <div class="flex flex-col gap-6">
                 <div class="card h-full flex flex-col">
                    <div class="card-header">
                       <div>
                          <h3 class="card-title">Podgląd Techniczny</h3>
                          <p class="card-subtitle" id="active-window-label">Nowe okno</p>
                       </div>
                       <div class="flex gap-2">
                          <button class="btn btn-sm btn-outline" id="btn-dxf-export">Pobierz DXF</button>
                       </div>
                    </div>
                    <div class="card-body flex-1 bg-slate-100 rounded-lg border border-slate-200 relative overflow-hidden flex items-center justify-center p-4">
                       <canvas id="window-canvas" class="shadow-2xl rounded max-w-full max-h-[600px]"></canvas>
                       <div id="bars-overlay" class="absolute inset-0 pointer-events-none"></div>
                    </div>
                    <div class="card-footer justify-between">
                       <div class="text-xs text-slate-500">
                          <p>Kółko myszy: Zoom • Lewy przycisk: Przesuwanie</p>
                       </div>
                    </div>
                 </div>

                 <div class="card">
                    <div class="card-header">
                       <h3 class="card-title text-base">Okna w projekcie</h3>
                    </div>
                    <div class="card-body">
                       <ul id="windows-list" class="space-y-2">
                          <li class="empty-state">Brak okien w projekcie. Zapisz bieżące okno.</li>
                       </ul>
                    </div>
                    <div class="card-footer">
                       <button id="btn-finish-project" class="btn btn-primary w-full">Zakończ i generuj raporty</button>
                    </div>
                 </div>
              </div>

            </div>
          </div>

          <div id="view-precut" class="view-panel hidden">
             <div class="mb-6 flex items-center justify-between">
                <h2 class="text-2xl font-bold">Listy Pre-Cut</h2>
                <div class="flex gap-2 bg-white p-1 rounded-lg border border-slate-200">
                   <button data-precut="sash" class="precut-tab btn btn-sm btn-primary">Sash (5.9m)</button>
                   <button data-precut="box" class="precut-tab btn btn-sm btn-ghost">Box (2.5m)</button>
                </div>
             </div>
             <div id="precut-content" class="grid gap-6 grid-cols-1 xl:grid-cols-2"></div>
          </div>

          <div id="view-cutlists" class="view-panel hidden">
             <div class="mb-6 flex items-center justify-between">
                <h2 class="text-2xl font-bold">Listy Cięć (Final)</h2>
                <div class="flex gap-2 bg-white p-1 rounded-lg border border-slate-200">
                   <button data-cutlist="box" class="cutlist-tab btn btn-sm btn-primary">Box</button>
                   <button data-cutlist="sash" class="cutlist-tab btn btn-sm btn-ghost">Sash</button>
                </div>
             </div>
             <div class="card overflow-hidden">
                <div id="cutlist-content" class="table-container"></div>
             </div>
          </div>
          
          <div id="view-optimizer" class="view-panel hidden">
             <div class="card">
                <div class="card-header">
                   <h3 class="card-title">Optymalizacja Rozkroju</h3>
                   <button data-action="run-optimization" class="btn btn-primary">Uruchom obliczenia</button>
                </div>
                <div class="card-body">
                   <div class="grid grid-cols-4 gap-4 mb-6">
                      <div class="form-group">
                         <label class="form-label">Długość sztangi (mm)</label>
                         <input id="stock-length" type="number" class="form-input" value="5900">
                      </div>
                      <div class="form-group">
                         <label class="form-label">Rzaz (Kerf)</label>
                         <input id="kerf" type="number" class="form-input" value="3">
                      </div>
                   </div>
                   <div id="optimization-output" class="space-y-4">
                      <p class="text-slate-500">Kliknij "Uruchom obliczenia" aby wygenerować schemat cięcia.</p>
                   </div>
                </div>
             </div>
          </div>
          
           <div id="view-reports" class="view-panel hidden">
              <div class="grid gap-6 md:grid-cols-2">
                 <div class="card">
                    <div class="card-header">
                       <h3 class="card-title">Podsumowanie Szklenia</h3>
                    </div>
                    <div id="glazing-summary" class="card-body table-container"></div>
                 </div>
                 <div class="card">
                    <div class="card-header">
                       <h3 class="card-title">Ustawienia globalne</h3>
                    </div>
                    <div class="card-body space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                           <div class="form-group">
                              <label class="form-label">Stock Sash (mm)</label>
                              <input id="settings-stock-sash" class="form-input">
                           </div>
                           <div class="form-group">
                              <label class="form-label">Stock Box (mm)</label>
                              <input id="settings-stock-box" class="form-input">
                           </div>
                        </div>
                        <div id="settings-section-map" class="space-y-2"></div>
                        <button id="open-settings" class="btn btn-outline w-full mt-4">Więcej ustawień</button>
                    </div>
                 </div>
              </div>
           </div>

        </div>
      </main>
    </div>
    
    <footer class="bg-white border-t border-slate-200 px-6 py-2 flex justify-between items-center text-xs text-slate-500">
       <div>
          <span id="timestamp"></span>
       </div>
       <div>
          Sash Production Planner v2.1 • <span id="status-text">Gotowy</span>
       </div>
    </footer>
  </div>
  
  <script type="module">
     // Prosty router widoków wbudowany w HTML dla kompatybilności
     import { setActiveView } from './js/state.js';
     
     document.querySelectorAll('[data-view-trigger]').forEach(btn => {
        btn.addEventListener('click', () => {
           // UI active state
           document.querySelectorAll('[data-view-trigger]').forEach(b => b.classList.remove('is-active'));
           btn.classList.add('is-active');
           
           // Hide/Show panels
           const viewName = btn.dataset.viewTrigger;
           document.querySelectorAll('.view-panel').forEach(p => p.classList.add('hidden'));
           const target = document.getElementById(`view-${viewName}`);
           if(target) target.classList.remove('hidden');
           
           // Update State
           setActiveView(viewName);
        });
     });
     
     // Inicjalizacja przy starcie
     import './js/app.js';
  </script>
</body>
</html>